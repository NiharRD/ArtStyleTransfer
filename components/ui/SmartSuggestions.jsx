import { ScrollView, StyleSheet, Text, View } from "react-native";
import { SvgXml } from "react-native-svg";
import { Colors, Spacing, Typography } from "../../constants/Theme";
import SuggestionChip from "./SuggestionChip";

// Sparkles icon for header
const sparklesIcon = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M9.8132 15.9038L9 18.75L8.1868 15.9038C7.75968 14.4089 6.59112 13.2403 5.09619 12.8132L2.25 12L5.09619 11.1868C6.59113 10.7597 7.75968 9.59112 8.1868 8.09619L9 5.25L9.8132 8.09619C10.2403 9.59113 11.4089 10.7597 12.9038 11.1868L15.75 12L12.9038 12.8132C11.4089 13.2403 10.2403 14.4089 9.8132 15.9038Z" stroke="#E6E6E6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M18.2589 8.71454L18 9.75L17.7411 8.71454C17.4388 7.50533 16.4947 6.56117 15.2855 6.25887L14.25 6L15.2855 5.74113C16.4947 5.43883 17.4388 4.49467 17.7411 3.28546L18 2.25L18.2589 3.28546C18.5612 4.49467 19.5053 5.43883 20.7145 5.74113L21.75 6L20.7145 6.25887C19.5053 6.56117 18.5612 7.50533 18.2589 8.71454Z" stroke="#E6E6E6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M16.8942 20.5673L16.5 21.75L16.1058 20.5673C15.8818 19.8954 15.3546 19.3682 14.6827 19.1442L13.5 18.75L14.6827 18.3558C15.3546 18.1318 15.8818 17.6046 16.1058 16.9327L16.5 15.75L16.8942 16.9327C17.1182 17.6046 17.6454 18.1318 18.3173 18.3558L19.5 18.75L18.3173 19.1442C17.6454 19.3682 17.1182 19.8954 16.8942 20.5673Z" stroke="#E6E6E6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`;

// SVG Icons as strings for SvgXml
const brushIcon = `<svg width="14" height="14" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M15.6042 17.2129C15.694 17.7085 15.7395 18.2308 15.7406 18.78C15.7406 22.1152 13.3148 25.1812 9.11209 25.5904C7.72391 25.7284 6.32327 25.5167 5.03781 24.9748C3.75235 24.4329 2.62294 23.5779 1.75249 22.4878C1.6112 22.3062 1.48818 22.1111 1.38521 21.9054C0.981198 21.0991 0.874512 20.1564 0.874512 19.233C1.42019 19.3152 1.92214 19.3117 2.36462 19.233C3.47521 19.0371 4.22026 18.3812 4.37242 17.484C4.77468 15.1054 6.2473 12.2424 10.074 12.2424C10.3352 12.2424 10.5888 12.2587 10.8348 12.2914L16.811 3.92435C17.2499 3.31089 17.8171 2.80034 18.4732 2.42818C19.1293 2.05602 19.8586 1.83117 20.6104 1.76925C21.3621 1.70733 22.1183 1.80982 22.8265 2.06961C23.5347 2.3294 24.1778 2.74025 24.7111 3.27363C25.2445 3.807 25.6554 4.45011 25.9152 5.15826C26.1749 5.86642 26.2774 6.62265 26.2155 7.37441C26.1536 8.12617 25.9287 8.85544 25.5566 9.51154C25.1844 10.1676 24.6739 10.7349 24.0604 11.1738L15.6042 17.2129ZM14.6248 14.6874L19.5551 11.1668C19.3179 10.5429 18.9512 9.97638 18.4791 9.50458C18.007 9.03278 17.4403 8.66642 16.8162 8.42966L13.3376 13.3005C13.8389 13.6783 14.2668 14.1406 14.6248 14.6874ZM21.7378 9.60846L22.5371 9.0383C22.8411 8.82112 23.0942 8.54033 23.2788 8.21544C23.4633 7.89055 23.5749 7.52936 23.6057 7.15699C23.6365 6.78462 23.5858 6.41 23.4572 6.05919C23.3286 5.70839 23.1251 5.3898 22.8609 5.1256C22.5967 4.86139 22.2781 4.6579 21.9273 4.52929C21.5765 4.40067 21.2019 4.35001 20.8295 4.38083C20.4572 4.41165 20.096 4.52321 19.7711 4.70775C19.4462 4.8923 19.1654 5.14539 18.9482 5.44944L18.3781 6.24871C19.8393 6.9655 21.021 8.14726 21.7378 9.60846ZM6.96088 17.9212C7.11129 17.0345 7.43659 16.2387 7.90531 15.7106C8.29883 15.2663 8.90572 14.8658 10.0775 14.8658C10.9817 14.8658 11.6743 15.2104 12.1728 15.7805C12.6922 16.3752 13.119 17.3651 13.119 18.78C13.119 20.7406 11.7443 22.6976 8.86024 22.9775C8.02233 23.0605 7.17639 22.9592 6.38179 22.6806C5.58718 22.402 4.86315 21.953 4.26049 21.3649C5.5897 20.7755 6.66356 19.6772 6.96088 17.9212Z" fill="#FFFFFF"/>
</svg>`;

const retroIcon = `<svg width="14" height="14" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M6.086 0.782006C5.96175 0.626589 5.78084 0.526897 5.58309 0.504861C5.38533 0.482826 5.18692 0.540252 5.0315 0.664506C4.87608 0.788759 4.77639 0.969663 4.75436 1.16742C4.73232 1.36518 4.78975 1.56359 4.914 1.71901L5.94 3.00001H4C3.20435 3.00001 2.44129 3.31608 1.87868 3.87869C1.31607 4.44129 1 5.20436 1 6.00001V11C0.999909 11.7594 1.28779 12.4905 1.80557 13.046C2.32335 13.6014 3.0325 13.9399 3.79 13.993L3.58 14.414C3.50095 14.5904 3.49308 14.7906 3.55804 14.9727C3.623 15.1548 3.75576 15.3047 3.92863 15.3913C4.1015 15.4779 4.30111 15.4943 4.48583 15.4373C4.67054 15.3802 4.82609 15.254 4.92 15.085L5.42 14.085C5.43398 14.0573 5.44666 14.0289 5.458 14H10.544C10.554 14.0287 10.566 14.057 10.58 14.085L11.08 15.085C11.1698 15.2614 11.3256 15.3951 11.5136 15.4571C11.7015 15.519 11.9063 15.5042 12.0834 15.4158C12.2605 15.3274 12.3954 15.1726 12.4588 14.9851C12.5223 14.7977 12.509 14.5927 12.422 14.415L12.211 13.993C12.9683 13.9396 13.6772 13.6011 14.1948 13.0456C14.7124 12.4902 15.0001 11.7592 15 11V6.00001C15 5.20436 14.6839 4.44129 14.1213 3.87869C13.5587 3.31608 12.7956 3.00001 12 3.00001H10.06L11.086 1.71901C11.2103 1.56359 11.2677 1.36518 11.2456 1.16742C11.2236 0.969663 11.1239 0.788759 10.9685 0.664506C10.8915 0.602981 10.8032 0.557217 10.7086 0.529825C10.6139 0.502433 10.5148 0.493951 10.4169 0.504861C10.2192 0.526897 10.0383 0.626589 9.914 0.782006L8.14 3.00001H7.86L6.086 0.782006ZM7.494 4.50001H12C12.3978 4.50001 12.7794 4.65804 13.0607 4.93935C13.342 5.22065 13.5 5.60218 13.5 6.00001V11C13.5 11.3978 13.342 11.7794 13.0607 12.0607C12.7794 12.342 12.3978 12.5 12 12.5H4C3.60218 12.5 3.22064 12.342 2.93934 12.0607C2.65804 11.7794 2.5 11.3978 2.5 11V6.00001C2.5 5.60218 2.65804 5.22065 2.93934 4.93935C3.22064 4.65804 3.60218 4.50001 4 4.50001H7.494ZM5.5 7.50001V9.50001H8V7.50001H5.5ZM5 6.00001C4.73478 6.00001 4.48043 6.10536 4.29289 6.2929C4.10536 6.48044 4 6.73479 4 7.00001V10C4 10.2652 4.10536 10.5196 4.29289 10.7071C4.48043 10.8946 4.73478 11 5 11H8.5C8.76522 11 9.01957 10.8946 9.20711 10.7071C9.39464 10.5196 9.5 10.2652 9.5 10V7.00001C9.5 6.73479 9.39464 6.48044 9.20711 6.2929C9.01957 6.10536 8.76522 6.00001 8.5 6.00001H5ZM12 6.75001C12 6.55109 11.921 6.36033 11.7803 6.21968C11.6397 6.07902 11.4489 6.00001 11.25 6.00001C11.0511 6.00001 10.8603 6.07902 10.7197 6.21968C10.579 6.36033 10.5 6.55109 10.5 6.75001V10.25C10.5 10.4489 10.579 10.6397 10.7197 10.7803C10.8603 10.921 11.0511 11 11.25 11C11.4489 11 11.6397 10.921 11.7803 10.7803C11.921 10.6397 12 10.4489 12 10.25V6.75001Z" fill="white"/>
</svg>`;

const blurIcon = `<svg width="14" height="14" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M11.995 0.667011C11.9871 0.566793 11.9591 0.469186 11.9128 0.379991C11.8664 0.290796 11.8026 0.211834 11.7251 0.147798C11.6476 0.0837622 11.558 0.0359592 11.4617 0.00723022C11.3653 -0.0214987 11.2642 -0.0305672 11.1643 -0.0194362C11.0644 -0.00830516 10.9677 0.0227981 10.8801 0.0720251C10.7924 0.121252 10.7155 0.187598 10.654 0.267119C10.5925 0.346641 10.5477 0.437715 10.5221 0.534929C10.4965 0.632142 10.4907 0.733511 10.505 0.833011L11.19 7.00001H10.323C8.683 7.00001 7.427 8.44901 7.126 10.06C6.89477 11.2588 6.49054 12.4175 5.926 13.5C5.434 14.448 5 15 5 15H13.5C13.5 15 15.58 13.266 15.988 9.51001C16.14 8.09401 14.91 7.00001 13.488 7.00001H12.7L11.995 0.667011ZM3.75 2.50001C3.55109 2.50001 3.36032 2.57903 3.21967 2.71968C3.07902 2.86033 3 3.0511 3 3.25001C3 3.44892 3.07902 3.63969 3.21967 3.78034C3.36032 3.92099 3.55109 4.00001 3.75 4.00001H8.25C8.44891 4.00001 8.63968 3.92099 8.78033 3.78034C8.92098 3.63969 9 3.44892 9 3.25001C9 3.0511 8.92098 2.86033 8.78033 2.71968C8.63968 2.57903 8.44891 2.50001 8.25 2.50001H3.75ZM0.75 6.00001C0.551088 6.00001 0.360322 6.07903 0.21967 6.21968C0.0790176 6.36033 0 6.5511 0 6.75001C0 6.94892 0.0790176 7.13969 0.21967 7.28034C0.360322 7.42099 0.551088 7.50001 0.75 7.50001H6.25C6.44891 7.50001 6.63968 7.42099 6.78033 7.28034C6.92098 7.13969 7 6.94892 7 6.75001C7 6.5511 6.92098 6.36033 6.78033 6.21968C6.63968 6.07903 6.44891 6.00001 6.25 6.00001H0.75ZM1 10.25C1 10.0511 1.07902 9.86033 1.21967 9.71968C1.36032 9.57903 1.55109 9.50001 1.75 9.50001H4.25C4.44891 9.50001 4.63968 9.57903 4.78033 9.71968C4.92098 9.86033 5 10.0511 5 10.25C5 10.4489 4.92098 10.6397 4.78033 10.7803C4.63968 10.921 4.44891 11 4.25 11H1.75C1.55109 11 1.36032 10.921 1.21967 10.7803C1.07902 10.6397 1 10.4489 1 10.25ZM7.593 13.5C7.986 12.634 8.373 11.56 8.601 10.335C8.819 9.16701 9.646 8.50001 10.322 8.50001H13.489C13.821 8.50001 14.107 8.63001 14.286 8.80301C14.3624 8.87016 14.4214 8.9548 14.458 9.0497C14.4945 9.14461 14.5076 9.24696 14.496 9.34801C14.321 10.97 13.788 12.127 13.323 12.862C13.1835 13.0845 13.0295 13.2977 12.862 13.5H11.863C12.402 12.794 12.75 11.772 12.75 10.75H12C11.649 11.979 10.928 12.838 9.838 13.5H7.593Z" fill="white"/>
</svg>`;

const instagramIcon = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M7.0301.084c-1.2768.0602-2.1487.264-2.911.5634-.7888.3075-1.4575.72-2.1228 1.3877-.6652.6677-1.075 1.3368-1.3802 2.127-.2954.7638-.4956 1.6365-.552 2.914-.0564 1.2775-.0689 1.6882-.0626 4.947.0062 3.2586.0206 3.6671.0825 4.9473.061 1.2765.264 2.1482.5635 2.9107.308.7889.72 1.4573 1.388 2.1228.6679.6655 1.3365 1.0743 2.1285 1.38.7632.295 1.6361.4961 2.9134.552 1.2773.056 1.6884.069 4.9462.0627 3.2578-.0062 3.668-.0207 4.9478-.0814 1.28-.0607 2.147-.2652 2.9098-.5633.7889-.3086 1.4578-.72 2.1228-1.3881.665-.6682 1.0745-1.3378 1.3795-2.1284.2957-.7632.4966-1.636.552-2.9124.056-1.2809.0692-1.6898.063-4.948-.0063-3.2583-.021-3.6668-.0817-4.9465-.0607-1.2797-.264-2.1487-.5633-2.9117-.3084-.7889-.72-1.4568-1.3876-2.1228C21.2982 1.33 20.628.9208 19.8378.6165 19.074.321 18.2017.1197 16.9244.0645 15.6471.0093 15.236-.005 11.977.0014 8.718.0076 8.31.0215 7.0301.0839m.1402 21.6932c-1.17-.0509-1.8053-.2453-2.2287-.408-.5606-.216-.96-.4771-1.3819-.895-.422-.4178-.6811-.8186-.9-1.378-.1644-.4234-.3624-1.058-.4171-2.228-.0595-1.2645-.072-1.6442-.079-4.848-.007-3.2037.0053-3.583.0607-4.848.05-1.169.2456-1.805.408-2.2282.216-.5613.4762-.96.895-1.3816.4188-.4217.8184-.6814 1.3783-.9003.423-.1651 1.0575-.3614 2.227-.4171 1.2655-.06 1.6447-.072 4.848-.079 3.2033-.007 3.5835.005 4.8495.0608 1.169.0508 1.8053.2445 2.228.408.5608.216.96.4754 1.3816.895.4217.4194.6816.8176.9005 1.3787.1653.4217.3617 1.056.4169 2.2263.0602 1.2655.0739 1.645.0796 4.848.0058 3.203-.0055 3.5834-.061 4.848-.051 1.17-.245 1.8055-.408 2.2294-.216.5604-.4763.96-.8954 1.3814-.419.4215-.8181.6811-1.3783.9-.4224.1649-1.0577.3617-2.2262.4174-1.2656.0595-1.6448.072-4.8493.079-3.2045.007-3.5825-.006-4.848-.0608M16.953 5.5864A1.44 1.44 0 1 0 18.39 4.144a1.44 1.44 0 0 0-1.437 1.4424M5.8385 12.012c.0067 3.4032 2.7706 6.1557 6.173 6.1493 3.4026-.0065 6.157-2.7701 6.1506-6.1733-.0065-3.4032-2.771-6.1565-6.174-6.1498-3.403.0067-6.156 2.771-6.1496 6.1738M8 12.0077a4 4 0 1 1 4.008 3.9921A3.9996 3.9996 0 0 1 8 12.0077" fill="white"/>
</svg>`;

// Suggestion data
const hardcodedSuggestions = [
  {
    id: "transform-portrait",
    label: "Transform image into digital potrait",
    icon: brushIcon,
  },
  {
    id: "add-retro",
    label: "Add retro effect",
    icon: retroIcon,
  },
  {
    id: "add-blur",
    label: "Add motion blur",
    icon: blurIcon,
  },
  {
    id: "instagram-ready",
    label: "Instagram Ready",
    icon: instagramIcon,
  },
];

import { Skeleton } from "moti/skeleton";

/**
 * SmartSuggestions - AI-powered suggestion chips section
 *
 * Features:
 * - Header with "Smart suggestions" text
 * - Horizontally scrollable rows of suggestion chips
 * - Glass effect styling
 * - Loading skeleton state
 */
const SmartSuggestions = ({ onSuggestionPress, isLoading = false, isVisible = true, suggestions: dynamicSuggestions = [] }) => {
  const handleSuggestionPress = (suggestion) => {
    if (onSuggestionPress) {
      onSuggestionPress(suggestion);
    } else {
      console.log("Suggestion pressed:", suggestion.label);
    }
  };

  if (!isVisible) return null;

  // Use dynamic suggestions if available, otherwise fallback to hardcoded (or empty if desired)
  // The user requested to use dynamic suggestions "in place of" hardcoded ones.
  // If dynamic suggestions are present, we use them.
  // If not present (e.g. initial load before AI), we might still show hardcoded or nothing.
  // Given the flow: Image Loaded -> Loading -> Dynamic Suggestions.
  // So if we have dynamic suggestions, we show them.

  const displaySuggestions = dynamicSuggestions.length > 0 ? dynamicSuggestions : hardcodedSuggestions;

  return (
    <View style={styles.container}>
      {/* Header */}
      <View style={styles.header}>
        <SvgXml xml={sparklesIcon} width={14} height={14} />
        <Text style={styles.headerText}>Smart suggestions</Text>
      </View>

      {isLoading ? (
        // Skeleton Loading State
        <View style={{ gap: 8 }}>
          <Skeleton colorMode="dark" width="100%" height={36} radius={18} />
          <Skeleton colorMode="dark" width="100%" height={36} radius={18} />
        </View>
      ) : (
        // Loaded State
        <>
          {/* First row of suggestions */}
          <ScrollView
            horizontal
            showsHorizontalScrollIndicator={false}
            contentContainerStyle={styles.scrollContent}
          >
            {displaySuggestions.slice(0, 2).map((suggestion) => (
              <SuggestionChip
                key={suggestion.id}
                label={suggestion.label}
                icon={suggestion.icon} // Will be undefined for dynamic suggestions, which is handled by SuggestionChip
                onPress={() => handleSuggestionPress(suggestion)}
              />
            ))}
          </ScrollView>

          {/* Second row of suggestions */}
          <ScrollView
            horizontal
            showsHorizontalScrollIndicator={false}
            contentContainerStyle={styles.scrollContent}
          >
            {displaySuggestions.slice(2).map((suggestion) => (
              <SuggestionChip
                key={suggestion.id}
                label={suggestion.label}
                icon={suggestion.icon}
                onPress={() => handleSuggestionPress(suggestion)}
              />
            ))}
          </ScrollView>
        </>
      )}
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    paddingHorizontal: Spacing.xxl,
    paddingVertical: Spacing.md,
    gap: Spacing.md,
  },
  header: {
    flexDirection: "row",
    alignItems: "center",
    gap: 5,
    marginBottom: 4,
  },
  headerText: {
    fontFamily: Typography.fontFamily.medium,
    fontSize: Typography.fontSize.md,
    color: Colors.textPrimary,
    letterSpacing: Typography.letterSpacing.tight,
  },
  scrollContent: {
    flexDirection: "row",
    gap: Spacing.md,
  },
});

export default SmartSuggestions;
